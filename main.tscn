[gd_scene load_steps=4 format=3 uid="uid://xhtgkc2suxbe"]

[ext_resource type="PackedScene" uid="uid://btubenec55x0o" path="res://cell.tscn" id="1_hestf"]

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_0x6yd"]
bg_color = Color(0.147672, 0.147672, 0.147672, 1)
border_width_left = 2
border_width_top = 2
border_width_right = 2
border_width_bottom = 2

[sub_resource type="GDScript" id="GDScript_p5304"]
script/source = "extends Button

@export var cell : PackedScene
@export var center : CenterContainer

var cells = [] 


func _on_pressed() -> void:
	check_cells()

func spawn_cell():
	var cell_instance = cell.instantiate() #create an instance of the cell
	center.add_child(cell_instance) #add the cell as a child of the center(to spawn to center)
	cells.append(cell_instance) #append to the cells array
	
	for i in cells.size(): #change cell's shake based on the amount of cells
		cells[i].change_shake(cells.size() * 0.15)
		cells[i].change_intensity(cells.size() * 0.17)
	print(self, \">cell count: \", cells.size())

func check_cells(): #check how many cells there are
	if cells.size() < 3: #If cell is less than 3(meaning it's still not strong enough to initiate chain reaction)
		spawn_cell() 
	else: #else pop a chain reaction
		pop()

func pop():
	spawn_cell()
	cells[0].pop(Vector2(1, 0))
	cells[1].pop(Vector2(-1, 0))
	cells[2].pop(Vector2(0, -1))
	cells[3].pop(Vector2(0, 1))
"

[node name="main" type="Node2D"]

[node name="Cell_spawner" type="Button" parent="." node_paths=PackedStringArray("center")]
custom_minimum_size = Vector2(96, 96)
offset_left = 328.0
offset_top = 249.0
offset_right = 328.0
offset_bottom = 249.0
theme_override_styles/normal = SubResource("StyleBoxFlat_0x6yd")
script = SubResource("GDScript_p5304")
cell = ExtResource("1_hestf")
center = NodePath("CenterContainer")

[node name="CenterContainer" type="CenterContainer" parent="Cell_spawner"]
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
grow_horizontal = 2
grow_vertical = 2
use_top_left = true

[connection signal="pressed" from="Cell_spawner" to="Cell_spawner" method="_on_pressed"]
